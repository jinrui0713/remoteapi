# プログラム機能一覧

## 概要
Yt-Dlp API Server は、YouTube などの動画サイトから動画をダウンロードできる Windows 用の高機能サーバーアプリケーションです。複数のPCを連携させて、効率的な動画管理とダウンロードを実現します。

## 主要機能

### 1. 動画ダウンロード機能
- **YouTube 対応**: YouTube を含む多数の動画サイトからのダウンロードに対応
- **品質選択**: 動画品質（best, 1080p, 720p, 480p）を選択可能
- **音声のみ抽出**: 動画から音声のみを抽出（MP3, M4A, WAV 形式）
- **字幕ダウンロード**: 字幕の自動ダウンロードと埋め込みに対応
- **プレイリスト対応**: プレイリストの一括ダウンロード（最大10件）
- **クッキー対応**: cookies.txt を使用した会員限定コンテンツのダウンロード

### 2. マルチサーバー管理
- **複数サーバー連携**: 複数のPCをサーバーノードとして登録可能
- **負荷分散**: "Auto" モードで最も空いているサーバーに自動割り振り
- **統合ライブラリ**: すべてのサーバーのファイルを一元管理
- **サーバー状態監視**: 各サーバーのステータスとジョブ状況をリアルタイム表示

### 3. Web管理画面
- **直感的なUI**: ブラウザベースの使いやすい管理画面
- **ジョブ管理**: ダウンロードジョブの進捗状況をリアルタイム表示
- **ファイル管理**: ダウンロード済みファイルの閲覧、再生、削除
- **一括操作**: 複数ファイルの一括ダウンロード・削除
- **検索機能**: YouTube 動画の検索機能を内蔵

### 4. 認証・セキュリティ機能
- **ユーザー認証**: ログイン機能による安全なアクセス管理
- **ロールベースアクセス**: 管理者(admin)と一般ユーザー(user)の権限分離
- **IP ブロック機能**: 不正アクセスの IP アドレスをブロック
- **セッション管理**: セキュアなセッション管理
- **ユーザー登録**: 新規ユーザーの登録申請と管理者承認機能

### 5. 管理者機能
- **統計情報**: アクティブクライアント数、セッション数、ディスク使用量の表示
- **アクセスログ**: ユーザーアクセスやダウンロード履歴の記録
- **帯域幅管理**: ネットワーク使用量の監視と制限
- **ファイルマネージャー**: サーバー上のファイルを直接管理
- **ログビューア**: サーバーログの閲覧と検索
- **ユーザー管理**: ユーザーの承認、削除、権限変更

### 6. プロキシ機能
- **匿名ブラウジング**: Web サイトを匿名で閲覧可能
- **HTML リライト**: プロキシ経由でのコンテンツ表示に対応
- **帯域幅制限**: プロキシ使用量の監視と制限

### 7. システム管理
- **自動起動**: Windows 起動時にサーバーを自動起動
- **自動リカバリー**: プロセス停止時の自動再起動機能
- **リモートアクセス**: Cloudflare Tunnel による外部公開機能
- **自動更新**: ワンクリックでの最新版へのアップデート
- **PWA 対応**: スマートフォンでのアプリ風の利用が可能

### 8. ファイル管理
- **ゴミ箱機能**: 削除ファイルは一時的にゴミ箱に保存
- **ストリーミング再生**: ダウンロード済みファイルのブラウザ再生
- **一括ダウンロード**: 複数ファイルを ZIP でまとめてダウンロード
- **ファイル情報表示**: ファイルサイズ、作成日時などの詳細情報

### 9. API機能
- **REST API**: プログラムから利用可能な REST API を提供
- **OpenAPI仕様**: API 仕様書 (openapi.json) を自動生成
- **Python クライアント例**: client_example.py でAPI利用例を提供

### 10. その他の機能
- **FFmpeg 統合**: 動画・音声の変換処理に対応
- **進捗表示**: ダウンロード速度、残り時間、進捗率の表示
- **エラーハンドリング**: エラー時の詳細メッセージ表示
- **ログローテーション**: ログファイルの自動ローテーション（1MB毎）
- **多言語対応**: 日本語を含む多言語環境に対応

## 技術仕様

### バックエンド
- **フレームワーク**: FastAPI (Python)
- **動画処理**: yt-dlp
- **データベース**: SQLite
- **非同期処理**: asyncio, uvicorn

### フロントエンド
- **インターフェース**: HTML5 + JavaScript
- **PWA**: Progressive Web App 対応
- **Service Worker**: オフライン機能とプッシュ通知

### セキュリティ
- **暗号化**: cryptography ライブラリによるペイロード暗号化
- **認証**: Cookie ベースのセッション管理
- **CORS**: Cross-Origin Resource Sharing 対応

## 対応環境
- **OS**: Windows 10/11 (主要対応)、Linux/macOS (実験的)
- **Python**: 3.12 以上
- **ブラウザ**: Chrome, Edge, Firefox (最新版推奨)

## ポート設定
- **デフォルトポート**: 8000
- **設定変更**: インストール時またはコマンドライン引数で変更可能
- **ファイアウォール**: 自動設定スクリプトで対応

## データ保存場所
- **ダウンロードファイル**: `%LOCALAPPDATA%\YtDlpApiServer\downloads`
- **ゴミ箱**: `%LOCALAPPDATA%\YtDlpApiServer\trash`
- **一時フォルダ**: `%LOCALAPPDATA%\YtDlpApiServer\temp`
- **データベース**: プロジェクトフォルダ内 `ytdlp_server.db`
- **ログファイル**: プロジェクトフォルダ内 `server.log`

## 使用例

### 基本的なダウンロード
1. ブラウザで `http://localhost:8000` にアクセス
2. 動画URLを入力
3. 品質とサーバーを選択
4. 「Start Download」をクリック

### API経由でのダウンロード
```python
import requests

response = requests.post("http://localhost:8000/download", json={
    "url": "https://www.youtube.com/watch?v=xxxxx",
    "type": "video",
    "quality": "720"
})
print(response.json())
```

## まとめ
このプログラムは、個人や小規模チームでの動画ダウンロードと管理を効率化するための包括的なソリューションです。マルチサーバー対応により、複数のPCのストレージと処理能力を活用でき、Web ベースの管理画面により、どこからでも簡単に操作できます。
